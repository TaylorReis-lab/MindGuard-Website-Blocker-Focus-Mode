name: Release Extension

on:
  push:
    tags:
      - "v*"

jobs:
  build-and-release:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ğŸ”– Sincronizar versÃ£o da tag com manifest.json
        run: |
          TAG_VERSION="${GITHUB_REF_NAME#v}"
          echo "VersÃ£o detectada: $TAG_VERSION"

          jq --arg v "$TAG_VERSION" '.version = $v' manifest.json > manifest.tmp.json
          mv manifest.tmp.json manifest.json

      - name: ğŸ“¦ Build da extensÃ£o
        run: |
          mkdir -p dist
          zip -r dist/extension.zip src manifest.json README.md

      - name: ğŸš€ Criar Release
        uses: softprops/action-gh-release@v1
        with:
          files: dist/extension.zip
          name: "ExtensÃ£o - ${{ github.ref_name }}"
          body: |
            ğŸš€ Nova versÃ£o da extensÃ£o

            ğŸ”– VersÃ£o: ${{ github.ref_name }}
            ğŸ“¦ Build sincronizado com o manifest.json
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
